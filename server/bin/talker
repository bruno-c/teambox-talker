#!/usr/bin/env ruby

$:.unshift File.dirname(__FILE__) + "/../lib"
require "rubygems"
require "talker"
require "amqp"

EM.run do
  AMQP.connect :host => 'localhost'
  
  server = Talker::Server.new
  trap('INT') do
    puts "Stopping ..."
    server.stop
    # FIXME hang
    #AMQP.stop { EM.stop }
    EM.stop
  end

  puts "Listening on #{server.host}:#{server.port}"
  server.start
end