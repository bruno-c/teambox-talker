#!/usr/bin/env ruby
$:.unshift File.dirname(__FILE__) + "/../lib"
require "rubygems"
require "talker"

abort "usage: talker-logger [config_file.yml]" unless ARGV.first

config = Talker::Config.new(ARGV.first)

trap('INT') do
  AMQP.stop { EM.stop }
end

EM.run do
  AMQP.connect config[:amqp]
  Talker::Logger.start config[:database]
end