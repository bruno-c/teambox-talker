<% @title = "Chat Logs of #{@room.name} for " + human_date(@date) %>

<% content_for :head do %>
  <script type="text/javascript" charset="utf-8">
  //<![CDATA[
    Talker.currentUser = <%= current_user.to_json %>;
    
    $(function(){
      <%= install_core_plugins %>
      Talker.plugins.push(new Talker.UserList($('#people')));
      
      $.each(<%= escape_json @events.to_json %>, function(){
        Talker.Broadcaster.broadcastEvent(this);
      });
      
      var timestamp = window.location.href.match(/#(\d+)/);
      if (timestamp && timestamp[1]){
        window.setTimeout(function(){
          $('p[time=' + timestamp[1] + ']').scrollToCenter({
            complete: function(){
              $('p[time=' + timestamp[1] + ']').css({border: '1px dashed grey'}).highlight();
            }
          });
        },10);
      }  
    });
  //]]>
  </script>
<% end %>

<h2><%=h @title %></h2>

<div id="chat_log">
  <table id="log">
  </table>
</div>

<% content_for :sidebar do %>
  <div id="room" class="panel">
    <div class="content">
      <h4>Users in this log</h4>
      <ul class="people" id="people"></ul>
    </div>
  </div>
<% end %>
