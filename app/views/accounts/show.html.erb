<div class="sheet" id="account">
  <h2><%= @title = "Your Account" %></h2>
  
  <div class="content">
    <% form_for @account, :html => { :class => "lw80" } do |f| %>
      <%= f.error_messages %>
      
      <h3>Subscription Plan</h3>
      <% if @account.subscription_info_changed %>
        <div class="info">
          Your subscription is being updated, <%= link_to_function "refresh", "location.reload(true)" %> or come back in a few ...
        </div>
      <% else %>
        
        <!-- Change plan -->
        <ul id="plans">
        <% Plan.all.each do |plan| %>
          <li>
            <%= plan.name %>
            
            <% if plan == @account.plan %>
              <strong>Current</strong>
              <% if will_downgrade_to_free && !plan.free? %>
                <small>This plan won't renew and you'll be downgraded to the Free plan once it expires.</small>
              <% end %>
              <%= link_to "Update", @account.edit_subscriber_url(account_url(:changed => true)), :title => "Update your subscription information" unless plan.free? %>
              
            <% elsif !(will_downgrade_to_free && plan.free?) %>
              <%= link_to up_down_grade(plan), plan_path(plan), :method => :put %>
              
            <% end %>
          </li>
        <% end %>
        </ul>
        
      <% end %>
      
      <h3>Usage</h3>
      
      <p class="side_description">
        You've used <%= number_to_human_size @account.used_storage %> of your <%= number_to_human_size @account.features.max_storage %> file storage limit.
      </p>
      <strong>File storage</strong>
      <%= meter_tag @account.used_storage.to_f / @account.features.max_storage.to_f %>
      
      <p class="side_description">
        You're currently using <%= @account.connections.count %>
        of your <%= pluralize @account.features.max_connections, "simultaneous connections" %> limit.
      </p>
      <strong>Simultaneous user connections</strong>
      <%= meter_tag @account.connections.count.to_f / @account.features.max_connections.to_f %>
    
    <% end %>
  </div>
</div>
