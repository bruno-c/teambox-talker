- content_for :head do
  = javascript_include_tag "orbited", "protocol", "chat", :cache => "chat_all"

  :javascript
    Orbited.settings.hostname = '#{request.host}';
    Orbited.settings.port = #{Orbited.port};
    Orbited.settings.protocol = '#{request.ssl? ? "https" : "http"}'
    Orbited.settings.streaming = true;
    TCPSocket = Orbited.TCPSocket;
    
    $(function() {
      document.domain = document.domain;
      client = new TalkerClient();
      client.connect('#{Orbited.talker_host}', Orbited.talker_port, #{@room.unique_name.to_json}, #{current_user.login.to_json}, #{current_user.talker_token.to_json});
      // TODO hook client.onMessage or something to Chat.receive(message);
      
      $(window).bind('beforeunload', function() { client.close() });
    });
    

- @title = @room.name

#room
  #sidebar
    %h1&= @room.name
    %p&= @room.description
    %h2 Users
    %ul#users
      = render :partial => "user", :collection => @room.users
  %table#log
    = render :partial => "messages/message", :collection => @events
    %tr.message.event#message
      %td.author&= current_user.login
      %td.content
        %form#msgForm{:action => room_messages_path(@room)}
          %textarea#msgbox{:rows => 1}
