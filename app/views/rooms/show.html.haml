- @title = @room.name

- content_for :head do
  :javascript
    var chat;
    
    document.observe("dom:loaded", function() {
      chat = new Chat(#{@room.id}, $("log"));
      chat.scrollToBottom();
      
      $("msgbox").observe("keydown", function(event) {
        if (event.keyCode == Event.KEY_RETURN) {
          this.form.onsubmit();
          return false;
        }
      });
      
      $("msgbox").focus();
    });
    
    Element.observe(window, "beforeunload", function() {
      new Ajax.Request("#{leave_room_path(@room)}");
    });
    
  = orbited_javascript
  = stomp_connect @room.channel

#room
  #sidebar
    %h1= @room.name
  %table#log
    = render :partial => "messages/message", :collection => @events
  #message
    - form_remote_tag :url => room_messages_path(@room), :loading => "$('msgbox').value=''; $('msgbox').focus()" do
      %textarea#msgbox{:name => 'message'}
      = submit_tag "Send Message"
