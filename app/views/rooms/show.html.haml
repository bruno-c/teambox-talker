- content_for :head do
  :javascript
    Orbited.settings.hostname = '#{request.host}';
    Orbited.settings.port = #{Orbited.port};
    Orbited.settings.protocol = '#{request.ssl? ? "https" : "http"}'
    Orbited.settings.streaming = true;
    TCPSocket = Orbited.TCPSocket;
    
    $(function() {
      document.domain = document.domain;
      client = new TalkerClient({
        host: '#{Orbited.talker_host}', 
        port: #{Orbited.talker_port}, 
        room: #{@room.id}, 
        user: #{{:id => current_user.id, :name => current_user.name}.to_json},
        token: #{current_user.talker_token.to_json},
        onNewMessage: ChatRoom.onNewMessage, 
        onJoin: ChatRoom.onJoin, 
        onLeave: ChatRoom.onLeave
      });
      ChatRoom.client = client;
      // "user":{"id":"unique id","name":"user name",...}
      client.connect();
    });
    

- @title = @room.name

#room
  #sidebar
    %h1&= @room.name
    %p&= @room.description
    %h2 Users
    %ul#users
      = render :partial => "user", :collection => @room.users
  %table#log
    = render :partial => "messages/message", :collection => @events
    %tr.message.event#message
      %td.author&= current_user.name
      %td.new_content
        %form#msgForm{:action => room_messages_path(@room)}
          %textarea#msgbox{:rows => 1}
